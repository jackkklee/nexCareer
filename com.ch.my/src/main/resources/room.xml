<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="roomns">
	<resultMap type="room" id="roomResult">
	<result property="room_num"		 		column="room_num" />
	<result property="room_subject"			column="room_subject" />
	<result property="room_people"		 	column="room_people" />
	<result property="room_mem_id"		 		column="room_mem_id" />
	<result property="people_count"		 	column="people_count" />
	</resultMap>
	<select id="list" resultMap="roomResult">
			select * from (select rowNum rn, a.* from (select * from room order by room_num)a) order by rn desc
	</select>
	<select id="maxNum" resultType = "int" >
		select nvl(max(room_num),0)+1 from room
	</select>
	<insert id="insert" parameterType="room">
		insert into room values (#{room_num},#{room_subject},#{room_people},#{room_mem_id},0)
	</insert>
	<update id="upCount" parameterType="int">
		update room set people_count=people_count+1 where room_num=#{num} 
	</update>
	<update id="downCount" parameterType="int">
		update room set people_count=people_count-1 where room_num=#{selectNum} 
	</update>
	<delete id="delete">
		delete from room where people_count=0
	</delete>
	<select id="select" parameterType="int" resultType="room">
		select * from room where room_num=#{num}
	</select>
<!-- 	<insert id="insert" parameterType="req_board">
		<selectKey keyProperty="board_num" order="BEFORE" resultType="int">
			select nvl(max(board_num), 0) + 1 from req_board
		</selectKey>
		insert into req_board values (
		#{board_num},#{mem_id},#{board_subject},
		#{board_content},0,#{board_num},0,0,sysdate,'n',#{category})
	</insert>
	<select id="getBoard" parameterType="int" resultType="req_board">
		select * from req_board where board_num=#{board_num}
	</select>
	<update id="readcount" parameterType="int">
		update req_board set board_readcount=board_readcount+1 where board_num=#{board_num} 
	</update>	
	<update id="update">
		update req_board set board_subject=#{board_subject}, board_content=#{board_content}, category=#{category} where board_num=#{board_num} 
	</update>
	<update id="delete" >
		update req_board set  board_del='y' where board_num=#{board_num}
	</update>
	<select id="maxStep" parameterType="int" resultType="int">
		select  nvl(max(board_re_step), 0)+1 from req_board where board_ref=#{board_ref}
	</select>
	<update id="numupdate" parameterType="req_board">	
	<![CDATA[
		update req_board set board_num=board_num+1
			where board_num >
				(select max(board_num) from req_board 
				where board_num<#{board_num} 
				and board_ref=#{board_ref}
				and board_re_step=#{board_re_step}
				and board_re_level=#{board_re_level})
			and board_num<#{board_num}	
		]]>
	</update>	
	<select id="reSelect" parameterType="req_board" resultType="int" >
			<![CDATA[
			select nvl(min(board_num),#{board_num})-1 from req_board  
        	where board_num < #{board_num} 
				and board_ref = #{board_ref}
				and board_re_step = #{board_re_step}
				and board_re_level = #{board_re_level}
			]]>
	</select>
	<update id="increaseAncestor" parameterType="int">
		update req_board set board_num=board_num+1 where board_num>=#{board_num} 
	</update>	
	<insert id="reInsert" parameterType="req_board">
		insert into req_board values (
		#{board_num},#{mem_id},#{board_subject},
		#{board_content},0,#{board_ref},#{board_re_step},#{board_re_level},sysdate,'n',#{category})
	</insert>
	<select id="total" resultType="int" >
		select count(*) from req_board 
	</select> -->
</mapper>